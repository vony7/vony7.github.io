{% extends 'base.html' %}

{% block title %}{{ mission.name }} - ä»»åŠ¡è¯¦æƒ…{% endblock %}

{% block content %}

<style>
    /* Combined styles for this page */
    .mission-header { display: flex; align-items: center; margin-bottom: 20px; }
    .mission-patch { width: 150px; height: 150px; margin-right: 30px; object-fit: contain; }
    .mission-title { flex-grow: 1; }
    .button-link {
        display: inline-block; padding: 8px 15px; background-color: #007bff; color: white;
        text-decoration: none; border-radius: 4px; font-size: 0.9em; border: none; cursor: pointer;
    }
    .button-link:hover { background-color: #0056b3; }
    .info-row { display: flex; margin: 10px 0; }
    .info-label { font-weight: bold; width: 120px; }
    .ongoing { color: #d9534f; font-weight: bold; }
    
    /* New Crew Styles */
    .crew-section { margin-top: 30px; padding: 15px; background: #fff; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .crew-header { border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
    .crew-member { display: flex; align-items: center; margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 6px; transition: background 0.2s; }
    .crew-member:hover { background: #e9ecef; }
    .crew-photo { width: 60px; height: 60px; object-fit: cover; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-right: 15px; }
    .launch-theme { border-left: 5px solid #3498db; }
    .landing-theme { border-left: 5px solid #2ecc71; }
</style>

<div class="mission-header">
    <img src="{{ url_for('static', filename='images/patches/' ~ mission.mid|string ~ '.png') }}"
         alt="{{ mission.name }} ä»»åŠ¡å¾½ç« "
         class="mission-patch"
         onerror="this.src='{{ url_for('static', filename='images/patches/default.png') }}'">

    <div class="mission-title">
        <h1>{{ mission.name }}</h1>
        <h3>{{ mission.type }}é£è¡Œä»»åŠ¡</h3>
         <div style="margin-top: 15px;">
            <a href="{{ url_for('edit_mission', mid=mission.mid) }}" class="button-link">
                âœï¸ ç¼–è¾‘æ­¤ä»»åŠ¡ (Admin)
            </a>
        </div>
    </div>
</div>
<div class="mission-info">
    <div class="info-row">
        <div class="info-label">ä»»åŠ¡ä»£å· (MID):</div>
        <div>{{ mission.mid }}</div>
    </div>
    <div class="info-row">
        <div class="info-label">ä»»åŠ¡ç±»å‹:</div>
        <div>{{ mission.type }}</div>
    </div>
    <div class="info-row">
        <div class="info-label">å¼€å§‹æ—¶é—´:</div>
        <div>{{ mission.start }}</div>
    </div>
    <div class="info-row">
        <div class="info-label">ç»“æŸæ—¶é—´:</div>
        <div>{{ mission.end if mission.end else 'è¿›è¡Œä¸­ (Ongoing)' }}</div>
    </div>

    <div class="info-row">
        <div class="info-label" style="color: #e67e22;">æŒç»­æ—¶é—´:</div>
        <div style="font-weight: bold; font-size: 1.1em;">
            {{ duration.display }}
        </div>
    </div>
    <div class="info-row">
        <div class="info-label">ä»»åŠ¡çŠ¶æ€:</div>
        <div>
            {% if duration.status == 'completed' %}
                <span style="color: #27ae60; font-weight: bold;">âœ… å·²å®Œæˆ (Completed)</span>
            {% elif duration.status == 'ongoing' %}
                <span class="ongoing" style="color: #d9534f; font-weight: bold;">ğŸ”„ æ‰§è¡Œä¸­ (Ongoing)</span>
            {% elif duration.status == 'future' %}
                <span style="color: #f39c12; font-weight: bold;">â³ è®¡åˆ’ä¸­ (Planned)</span>
            {% endif %}
        </div>
    </div>
    </div>

{% if mission.type == 'è½½äºº' %}

    {# --- MACRO for rendering a single crew member to avoid code duplication --- #}
    {% macro render_astronaut(astronaut) %}
    <div class="crew-member">
        <img class="crew-photo"
             src="{{ astronaut.photo_url }}"
             alt="{{ astronaut.name }} ç…§ç‰‡"
             onerror="this.src='/static/images/astronauts/default.jpg'">
        <div>
            <h3><a href="/astronauts/{{ astronaut.uid }}" style="text-decoration: none; color: #2c3e50;">{{ astronaut.name }}</a></h3>
            <div style="color: #666; font-size: 0.9em;">
                ç¬¬{{ astronaut.group_id }}æ‰¹èˆªå¤©å‘˜ | 
                {% if astronaut.status == 1 %}ç°å½¹{% else %}é€€å½¹{% endif %}
            </div>
        </div>
    </div>
    {% endmacro %}

    {# --- LOGIC: Check if we need split views --- #}
    {% if same_crew %}
        <div class="crew-section">
            <h2 class="crew-header">ğŸš€ ä»»åŠ¡ä¹˜ç»„ (Mission Crew)</h2>
            {% for astronaut in launch_crew %}
                {{ render_astronaut(astronaut) }}
            {% else %}
                <p style="color: #999;">æš‚æ— ä¹˜ç»„ä¿¡æ¯</p>
            {% endfor %}
        </div>

    {% else %}
        <div class="crew-section launch-theme">
            <h2 class="crew-header" style="color: #2980b9;">ğŸ›« å‘å°„ä¹˜ç»„ (Launch Crew)</h2>
            {% for astronaut in launch_crew %}
                {{ render_astronaut(astronaut) }}
            {% endfor %}
        </div>

        <div class="crew-section landing-theme">
            <h2 class="crew-header" style="color: #27ae60;">ğŸ›¬ è¿”å›ä¹˜ç»„ (Landing Crew)</h2>
            {% for astronaut in landing_crew %}
                {{ render_astronaut(astronaut) }}
            {% else %}
                 <p style="color: #999; padding: 10px;">(å°šæœªç¡®å®š / TBD)</p>
            {% endfor %}
        </div>
    {% endif %}

{% endif %}
<div class="back-link" style="margin-top: 25px;">
    <a href="{{ url_for('mission_list') }}">&larr; è¿”å›ä»»åŠ¡åˆ—è¡¨</a>
</div>

{% endblock %}