{% extends 'base.html' %}

{% block title %}ä¸­å›½èˆªå¤©å‘˜ - Chinese Astronauts{% endblock %}

{% block content %}
    <style>
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }
    th {
      background-color: #800020;
      color: white;
      position: sticky;
      top: 0;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    tr:hover {
      background-color: #f5f5f5;
    }
    .filter-section {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  . }
    .filter-group {
      margin-bottom: 15px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
    }
    label {
      font-weight: bold;
      min-width: 60px;
    }
    select, input, button {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    button {
      background-color: #800020;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #600018;
    }
    .no-data {
      text-align: center;
      padding: 20px;
      color: #666;
    }
    .status-active {
      color: green;
      font-weight: bold;
    }
    .status-retired {
      color: #666;
    }
    .mission-list {
      max-width: 250px;
    }
    .mission-item {
      margin-bottom: 5px;
    }
    .sort-arrow {
      margin-left: 5px;
    }
    .total-time {
      font-weight: bold;
      color: #800020;
    }
    /* Mission status indicators */
    .mission-status {
      font-size: 0.8em;
      padding: 2px 5px;
      border-radius: 3px;
      margin-left: 5px;
    }
    .status-completed {
      background-color: #e0ffe0;
      color: #006400;
    }
    .status-ongoing {
      background-color: #fff8e0;
      color: #8a6d3b;
    }
    .status-future {
      background-color: #e0f7ff;
      color: #0d47a1;
    }
    /* Column width controls */
    .col-name { width: 10%; }
    .col-photo {
      width: 80px;
    }
    .astro-thumb {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      border: 1px solid #ccc;
    }

    .col-uid { width: 10%; }
    .col-gender { width: 8%; }
    .col-dob { width: 12%; }
    .col-group { width: 8%; }
    .col-status { width: 8%; }
    .col-missions { width: 25%; }
    .col-total { width: 14%; }
  </style>

  <div class="container" style="max-width: 1200px; margin: 0 auto;">
    <h1>ä¸­å›½èˆªå¤©å‘˜ (Chinese Astronauts)</h1>
<div style="margin: 20px 0;">
    <a href="/astronauts/chart/cumulative" class="btn-primary" style="background-color: #9b59b6; padding: 10px 20px; color: white; text-decoration: none; border-radius: 5px; display: inline-block;">
        ğŸ“Š æŸ¥çœ‹ç´¯è®¡æ—¶é•¿æ’å (View Cumulative Time Ranking)
    </a>
</div>

    <div class="filter-section">
            <form method="get" action="{{ url_for('chinese_astronauts') }}">
        <div class="filter-group">
          <label for="gender">æ€§åˆ«:</label>
          <select name="gender" id="gender">
            <option value="">å…¨éƒ¨</option>
            <option value="m" {% if selected_gender == 'm' %}selected{% endif %}>ç”·</option>
            <option value="f" {% if selected_gender == 'f' %}selected{% endif %}>å¥³</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="search">æœç´¢:</label>
          <input type="text" name="search" id="search" 
                 value="{{ search or '' }}" 
                 placeholder="å§“åæˆ–UID">
        </div>

        <div class="filter-group">
          <label for="group">æ‰¹æ¬¡:</label>
          <select name="group" id="group">
            <option value="">å…¨éƒ¨</option>
            {% for i in range(1, 4) %}
            <option value="{{ i }}" 
               {% if selected_group == i|string %}selected{% endif %}>
              ç¬¬{{ i }}æ‰¹
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="filter-group">
          <button type="submit">ç­›é€‰</button>
          <a href="{{ url_for('chinese_astronauts') }}" style="margin-left: 10px;">é‡ç½®</a>
        </div>
      </form>
    </div>

    <table>
      <thead>
        <tr>
          <th class="col-name">
            <a href="{{ url_for('chinese_astronauts', gender=selected_gender, search=search, group=selected_group, sort_by='name', order='asc' if not (sort_by == 'name' and order == 'asc') else 'desc') }}"
              style="color: white; text-decoration: none;">
              å§“å
              {% if sort_by == 'name' %}
                <span class="sort-arrow">{% if order == 'asc' %}â†‘{% else %}â†“{% endif %}</span>
              {% endif %}
            </a>
          </th>
          <th class="col-photo">ç…§ç‰‡</th>
          <th class="col-uid">UID</th>
          <th class="col-gender">æ€§åˆ«</th>
          <th class="col-dob">å‡ºç”Ÿæ—¥æœŸ</th>
          <th class="col-group">
            <a href="{{ url_for('chinese_astronauts', gender=selected_gender, search=search, group=selected_group, sort_by='group', order='asc' if not (sort_by == 'group' and order == 'asc') else 'desc') }}"
              style="color: white; text-decoration: none;">
              æ‰¹æ¬¡
              {% if sort_by == 'group' %}
                <span class="sort-arrow">{% if order == 'asc' %}â†‘{% else %}â†“{% endif %}</span>
              {% endif %}
            </a>
         </th>
          <th class="col-status">çŠ¶æ€</th>
           <th class="col-missions">æ‰§è¡Œä»»åŠ¡</th>
          <th class="col-total">
            <a href="{{ url_for('chinese_astronauts', gender=selected_gender, search=search, group=selected_group, sort_by='total', order='asc' if not (sort_by == 'total' and order == 'asc') else 'desc') }}"
              style="color: white; text-decoration: none;">
              å¤ªç©ºæ€»æ—¶é•¿
              {% if sort_by == 'total' %}
                <span class="sort-arrow">{% if order == 'asc' %}â†‘{% else %}â†“{% endif %}</span>
              {% endif %}
            </a>
          </th>
        </tr>
      </thead>
      <tbody>
                {% if astronauts %}
          {% for astro in astronauts %}
          <tr>
            <td><a href="{{ url_for('astronaut_profile', uid=astro.uid) }}">{{ astro.name }}</a></td>
            <td>
              <img class="astro-thumb" src="{{ astro.photo_url }}" alt="{{ astro.name }} ç…§ç‰‡"
                  onerror="this.src='/static/images/astronauts/default.jpg';">
            </td>

            <td>{{ astro.uid }}</td>
            <td>{{ 'ç”·' if astro.gender == 'm' else 'å¥³' }}</td>
            <td>{{ astro.DOB }}</td>
            <td>ç¬¬{{ astro.group_id }}æ‰¹</td>
            <td class="{% if astro.status == 1 %}status-active{% else %}status-retired{% endif %}">
              {{ 'ç°å½¹' if astro.status == 1 else 'é€€å½¹' }}
            </td>


            <td class="mission-list">
              {% if astro.missions %}
                {% for mission in astro.missions %}
               <div class="mission-item">
                  <a href="{{ url_for('mission_detail', mid=mission.mid) }}">{{ mission.name }}</a>
                  ({{ mission.duration_display }})
                  <span class="mission-status status-{{ mission.status }}">
                    {% if mission.status == 'completed' %}å·²å®Œæˆ
                    {% elif mission.status == 'ongoing' %}è¿›è¡Œä¸­
                    {% elif mission.status == 'future' %}è®¡åˆ’ä¸­
                    {% endif %}
                  </span>
                </div>
               {% endfor %}
              {% else %}
                
              {% endif %}
            </td>
            <td class="total-time">
              {{ astro.total_mission_time }}
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="9" class="no-data">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„èˆªå¤©å‘˜</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
{% endblock %}